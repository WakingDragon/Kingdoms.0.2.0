name: Unity License Test
on:
  workflow_dispatch:

env:
  UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
  UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
  UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}

jobs:
  license-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true
      
      - name: Check Unity Secrets
        run: |
          echo "Checking Unity license secrets..."
          if [ -z "$UNITY_EMAIL" ]; then
            echo "❌ UNITY_EMAIL is not set"
            exit 1
          else
            echo "✅ UNITY_EMAIL is set"
          fi
          
          if [ -z "$UNITY_PASSWORD" ]; then
            echo "❌ UNITY_PASSWORD is not set"
            exit 1
          else
            echo "✅ UNITY_PASSWORD is set"
          fi
          
          if [ -z "$UNITY_LICENSE" ]; then
            echo "❌ UNITY_LICENSE is not set"
            exit 1
          else
            echo "✅ UNITY_LICENSE is set (length: ${#UNITY_LICENSE} characters)"
          fi
          
          echo "All Unity license secrets are present!"

      - name: Test Unity License Activation
        uses: game-ci/unity-test-runner@v4
        env:
          UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
          UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
          UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
        with:
          unityVersion: 6000.2.2f1
          testMode: editmode
          checkName: License Test
        continue-on-error: true
      
      - name: Report Results
        run: |
          echo "Unity license test completed. Check the previous step for any licensing issues."