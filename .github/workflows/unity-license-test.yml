name: Unity License Test
on:
  workflow_dispatch:

env:
  UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
  UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
  UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}

jobs:
  license-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true
      
      - name: Check Unity Secrets
        run: ./scripts/validate-unity-license.sh

      - name: Test Unity License Activation
        uses: game-ci/unity-test-runner@v4
        env:
          UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
          UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
          UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
        with:
          unityVersion: 6000.2.2f1
          testMode: editmode
          checkName: License Test
          # Add custom parameters for Unity 6.x compatibility
          customParameters: -logfile -
        continue-on-error: true
      
      - name: Report Results
        run: |
          echo "Unity license test completed. Check the previous step for any licensing issues."